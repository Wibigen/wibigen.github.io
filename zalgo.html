<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zalgo Architect // Surcharge Textuelle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');

        :root {
            --neon-green: #00ff41;
            --dark-bg: #0a0a0a;
            --panel-bg: #111;
            --border-col: #222;
        }

        body {
            background-color: var(--dark-bg);
            color: #e0e0e0;
            font-family: 'JetBrains Mono', monospace;
            overflow: hidden;
            display: flex;
            height: 100vh;
        }

        /* Zone de travail principale */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            overflow-y: auto;
            border-right: 1px solid var(--border-col);
        }

        /* Panneau latéral fixe */
        .sidebar {
            width: 380px;
            background-color: var(--panel-bg);
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            overflow-y: auto;
            transition: opacity 0.3s ease;
        }

        .sidebar.inactive {
            opacity: 0.3;
            pointer-events: none;
            filter: grayscale(1);
        }

        /* Rendu des lettres */
        .visualizer-container {
            flex: 1;
            background-color: #050505;
            border: 1px solid var(--border-col);
            border-radius: 4px;
            padding: 4rem 2rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-content: flex-start;
            gap: 10px;
            overflow-y: auto;
        }

        .letter-box {
            display: inline-block;
            font-family: Arial, "Helvetica Neue", Helvetica, sans-serif; /* Meilleur pour Unicode */
            font-size: 3.5rem;
            line-height: 1;
            cursor: pointer;
            padding: 10px;
            border-radius: 4px;
            transition: all 0.2s;
            position: relative;
            /* Important pour la surcharge basse */
            margin-bottom: 50px; 
            min-width: 60px;
            text-align: center;
        }

        .letter-box:hover {
            background: rgba(0, 255, 65, 0.05);
        }

        .letter-box.selected {
            background: rgba(0, 255, 65, 0.1);
            outline: 1px solid var(--neon-green);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--neon-green); }

        .symbol-grid-item {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 40px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .symbol-checkbox:checked + .symbol-grid-item {
            background: var(--neon-green);
            color: black;
            border-color: var(--neon-green);
        }
    </style>
</head>
<body>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <header class="mb-6 flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold text-[#00ff41] tracking-tighter">ZALGO_ARCHITECT</h1>
                <p class="text-[10px] text-gray-500 uppercase tracking-widest">Advanced Text Overload Tool</p>
            </div>
            <button onclick="copyToClipboard()" class="bg-[#00ff41] text-black px-4 py-2 text-xs font-bold rounded hover:brightness-110 transition">
                COPIER LE RÉSULTAT
            </button>
        </header>

        <div class="mb-6">
            <label class="block text-[10px] uppercase text-gray-500 mb-2">Texte d'entrée</label>
            <input type="text" id="sourceInput" value="Wibigen" 
                   class="w-full bg-[#111] border border-[#333] p-3 text-white focus:outline-none focus:border-[#00ff41] rounded">
        </div>

        <div class="visualizer-container" id="visualizer">
            <!-- Injecté par JS -->
        </div>
        
        <textarea id="finalOutput" class="sr-only"></textarea>
    </div>

    <!-- SIDEBAR EDITOR -->
    <aside id="editorPanel" class="sidebar inactive">
        <div class="flex items-center justify-between mb-8">
            <h2 class="font-bold text-white uppercase text-sm tracking-widest">Éditeur de lettre</h2>
            <div id="currentLetterDisplay" class="w-12 h-12 flex items-center justify-center border border-[#00ff41] text-[#00ff41] text-2xl font-bold rounded">?</div>
        </div>

        <div id="selectMessage" class="text-center py-20 text-gray-600 text-xs italic">
            Cliquez sur une lettre pour la modifier
        </div>

        <div id="controls" class="hidden">
            <!-- SECTION HAUTE -->
            <div class="mb-8 border-b border-gray-800 pb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-[#00ff41] text-[10px] uppercase font-bold">▲ Surcharge Haute</h3>
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] text-gray-500">DENSITÉ:</span>
                        <input type="number" id="topDensity" min="1" max="20" value="1" class="w-10 bg-black border border-gray-700 text-xs text-center p-1 rounded">
                    </div>
                </div>
                <div class="grid grid-cols-5 gap-1" id="topGrid"></div>
            </div>

            <!-- SECTION LATERALE -->
            <div class="mb-8 border-b border-gray-800 pb-6">
                <h3 class="text-cyan-400 text-[10px] uppercase font-bold mb-4">► Surcharge Latérale</h3>
                <div class="grid grid-cols-5 gap-1" id="midGrid"></div>
            </div>

            <!-- SECTION BASSE -->
            <div class="mb-8 border-b border-gray-800 pb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-red-500 text-[10px] uppercase font-bold">▼ Surcharge Basse</h3>
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] text-gray-500">DENSITÉ:</span>
                        <input type="number" id="bottomDensity" min="1" max="20" value="1" class="w-10 bg-black border border-gray-700 text-xs text-center p-1 rounded">
                    </div>
                </div>
                <div class="grid grid-cols-5 gap-1" id="bottomGrid"></div>
            </div>

            <button onclick="resetLetter()" class="w-full py-2 border border-red-900 text-red-500 hover:bg-red-900 hover:text-white transition text-[10px] uppercase rounded">
                Réinitialiser la lettre
            </button>
        </div>
    </aside>

    <script>
        const SYMBOLS = {
            up: ['\u0300', '\u0301', '\u0302', '\u0303', '\u0307', '\u0308', '\u030A', '\u030B', '\u030C', '\u030D', '\u030E', '\u0310', '\u0311', '\u033D', '\u033E', '\u0346', '\u034A', '\u034B', '\u034C', '\u0350', '\u0351', '\u0352', '\u0357', '\u035B', '\u035D', '\u035E', '\u0360', '\u0361', '\u030F', '\u0311'],
            mid: ['\u0334', '\u0335', '\u0336', '\u0337', '\u0338', '\u0334', '\u20d2', '\u20d3', '\u20e0', '\u0332'],
            down: ['\u0316', '\u0317', '\u0318', '\u0319', '\u031C', '\u031D', '\u031E', '\u031F', '\u0320', '\u0323', '\u0324', '\u0325', '\u0326', '\u0327', '\u0328', '\u0329', '\u032A', '\u032B', '\u032C', '\u032D', '\u032E', '\u032F', '\u0330', '\u0331', '\u0332', '\u0333', '\u0339', '\u033A', '\u033B', '\u033C', '\u0345', '\u0347', '\u0348', '\u034D', '\u034E', '\u0353', '\u0354', '\u0355', '\u0356', '\u0359', '\u035A']
        };

        let textState = [];
        let selectedIndex = -1;

        const sourceInput = document.getElementById('sourceInput');
        const visualizer = document.getElementById('visualizer');
        const editorPanel = document.getElementById('editorPanel');
        const controls = document.getElementById('controls');
        const selectMessage = document.getElementById('selectMessage');

        function init() {
            const val = sourceInput.value;
            const newState = [];
            for (let i = 0; i < val.length; i++) {
                if (textState[i] && textState[i].char === val[i]) {
                    newState.push(textState[i]);
                } else {
                    newState.push({ char: val[i], up: [], mid: [], down: [], upDensity: 1, downDensity: 1 });
                }
            }
            textState = newState;
            if (selectedIndex >= textState.length) deselect();
            render();
        }

        function render() {
            visualizer.innerHTML = '';
            textState.forEach((item, index) => {
                const el = document.createElement('div');
                el.className = `letter-box ${index === selectedIndex ? 'selected' : ''}`;
                el.innerText = buildString(item);
                el.onclick = () => selectLetter(index);
                visualizer.appendChild(el);
            });
            updateFinalOutput();
        }

        function buildString(item) {
            let res = item.char;
            item.mid.forEach(s => res += s);
            for(let i=0; i<item.upDensity; i++) item.up.forEach(s => res += s);
            for(let i=0; i<item.downDensity; i++) item.down.forEach(s => res += s);
            return res;
        }

        function selectLetter(index) {
            selectedIndex = index;
            editorPanel.classList.remove('inactive');
            controls.classList.remove('hidden');
            selectMessage.classList.add('hidden');
            
            const item = textState[index];
            document.getElementById('currentLetterDisplay').innerText = item.char;
            document.getElementById('topDensity').value = item.upDensity;
            document.getElementById('bottomDensity').value = item.downDensity;

            renderGrid('topGrid', SYMBOLS.up, item.up, 'up');
            renderGrid('midGrid', SYMBOLS.mid, item.mid, 'mid');
            renderGrid('bottomGrid', SYMBOLS.down, item.down, 'down');
            
            render();
        }

        function deselect() {
            selectedIndex = -1;
            editorPanel.classList.add('inactive');
            controls.classList.add('hidden');
            selectMessage.classList.remove('hidden');
            document.getElementById('currentLetterDisplay').innerText = '?';
        }

        function renderGrid(containerId, symbolList, activeList, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            symbolList.forEach(s => {
                const label = document.createElement('label');
                const cb = document.createElement('input');
                cb.type = 'checkbox';
                cb.className = 'sr-only symbol-checkbox';
                cb.checked = activeList.includes(s);
                cb.onchange = (e) => toggleSymbol(type, s, e.target.checked);
                
                const div = document.createElement('div');
                div.className = 'symbol-grid-item';
                div.innerHTML = `&#9676;${s}`;
                
                label.appendChild(cb);
                label.appendChild(div);
                container.appendChild(label);
            });
        }

        function toggleSymbol(type, char, checked) {
            if (selectedIndex === -1) return;
            const list = textState[selectedIndex][type];
            if (checked) { if(!list.includes(char)) list.push(char); }
            else { textState[selectedIndex][type] = list.filter(c => c !== char); }
            render();
        }

        function updateDensity(type, val) {
            if (selectedIndex === -1) return;
            textState[selectedIndex][type] = parseInt(val) || 1;
            render();
        }

        function resetLetter() {
            if (selectedIndex === -1) return;
            textState[selectedIndex] = { 
                char: textState[selectedIndex].char, 
                up: [], mid: [], down: [], 
                upDensity: 1, downDensity: 1 
            };
            selectLetter(selectedIndex);
        }

        function updateFinalOutput() {
            document.getElementById('finalOutput').value = textState.map(buildString).join('');
        }

        async function copyToClipboard() {
            try {
                await navigator.clipboard.writeText(document.getElementById('finalOutput').value);
                alert("Texte copié !");
            } catch (err) {
                document.getElementById('finalOutput').select();
                document.execCommand('copy');
                alert("Texte copié !");
            }
        }

        sourceInput.addEventListener('input', init);
        document.getElementById('topDensity').addEventListener('input', (e) => updateDensity('upDensity', e.target.value));
        document.getElementById('bottomDensity').addEventListener('input', (e) => updateDensity('downDensity', e.target.value));

        init();
    </script>
</body>
</html>
