<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Code Generator - Pure Output</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Fira+Code:wght@400;500&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .loader {
            border-top-color: #3b82f6;
            animation: spinner 1.5s linear infinite;
        }

        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        pre[class*="language-"] {
            margin: 0 !important;
            border-radius: 0 0 0.5rem 0.5rem !important;
            background: #1e293b !important;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">
                Gemini Pure Code Architect
            </h1>
            <p class="text-slate-400 mt-2 text-sm md:text-base">Génération de code sans blabla, optimisée pour tous les langages.</p>
            
            <div id="statusWrapper" class="mt-4 flex flex-col items-center gap-2">
                <div id="apiStatus" class="inline-block px-4 py-1.5 rounded-full text-xs font-medium transition-all duration-300">
                    Vérification de la clé...
                </div>
                
                <!-- Input de clé manuelle -->
                <div id="manualKeySection" class="hidden w-full max-w-md mt-2 group">
                    <div class="relative">
                        <input type="password" id="manualApiKey" 
                               oninput="validateKeyInput()"
                               placeholder="Entrez votre clé API Gemini ici..." 
                               class="w-full bg-slate-900 border border-slate-700 rounded-lg pl-3 pr-10 py-2 text-xs text-slate-300 focus:ring-1 focus:ring-blue-500 focus:outline-none transition-all">
                        <div id="keyCheckIcon" class="absolute right-3 top-1/2 -translate-y-1/2 hidden text-emerald-500">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                        </div>
                    </div>
                    <p class="text-[10px] text-slate-500 mt-1">Votre clé est conservée localement pour cette session.</p>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 gap-6">
            <!-- Input Section -->
            <div class="glass-panel p-6 rounded-xl shadow-2xl">
                <label class="block text-sm font-medium text-slate-300 mb-2">Description du besoin ou prompt technique</label>
                <textarea 
                    id="userPrompt" 
                    rows="4" 
                    class="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-4 text-slate-200 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all placeholder-slate-500"
                    placeholder="Ex: Crée une fonction Python qui calcule la suite de Fibonacci avec mémoïsation..."
                ></textarea>
                
                <div class="flex flex-wrap items-center justify-between mt-4 gap-4">
                    <div class="flex gap-2">
                        <select id="languageHint" class="bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-slate-300 focus:outline-none">
                            <option value="auto">Auto-détection</option>
                            <option value="python">Python</option>
                            <option value="javascript">JavaScript</option>
                            <option value="typescript">TypeScript</option>
                            <option value="markup">HTML/CSS</option>
                            <option value="cpp">C++</option>
                            <option value="rust">Rust</option>
                            <option value="go">Go</option>
                            <option value="sql">SQL</option>
                        </select>
                    </div>
                    
                    <button 
                        onclick="generateCode()" 
                        id="generateBtn"
                        class="bg-blue-600 hover:bg-blue-500 text-white font-semibold py-2 px-6 rounded-lg transition-all flex items-center gap-2"
                    >
                        <span>Générer le code</span>
                        <div id="btnLoader" class="hidden w-4 h-4 border-2 border-white/30 border-t-white rounded-full loader"></div>
                    </button>
                </div>
            </div>

            <!-- Output Section -->
            <div id="outputContainer" class="hidden glass-panel rounded-xl overflow-hidden shadow-2xl">
                <div class="flex items-center justify-between px-4 py-2 bg-slate-800/50 border-b border-slate-700">
                    <span id="languageLabel" class="text-xs font-mono text-slate-400 uppercase tracking-widest">Code Généré</span>
                    <button 
                        onclick="copyCode()" 
                        class="text-xs bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded transition-colors flex items-center gap-1"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2" />
                        </svg>
                        <span id="copyText">Copier</span>
                    </button>
                </div>
                <div id="codeWrapper" class="relative">
                    <pre id="codeOutput" class="language-javascript"><code id="codeBlock"></code></pre>
                </div>
            </div>

            <div id="errorMessage" class="hidden p-4 bg-red-900/30 border border-red-500/50 text-red-200 rounded-lg text-sm"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-rust.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    
    <script>
        const ENV_API_KEY = ""; 
        const modelName = "gemini-2.5-flash-preview-09-2025";
        
        const systemPrompt = `Tu es un automate de génération de code pur. 
TA RÈGLE ABSOLUE : Tu ne dois répondre QUE par du code. 
- INTERDICTION de donner des explications avant ou après le code.
- INTERDICTION de mettre le code dans des blocs markdown. Donne le texte brut.
- Si l'utilisateur ne demande pas de code, réponds par un commentaire de code (// ou #) indiquant que tu ne génères que du code.`;

        const status = document.getElementById('apiStatus');
        const manualSection = document.getElementById('manualKeySection');
        const keyCheckIcon = document.getElementById('keyCheckIcon');

        function updateStatusUI(type) {
            if (type === 'env') {
                status.textContent = "● API connectée via l'environnement";
                status.className = "inline-block px-4 py-1.5 rounded-full bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 text-xs";
                manualSection.classList.add('hidden');
            } else if (type === 'valid') {
                status.textContent = "● Clé API manuelle configurée";
                status.className = "inline-block px-4 py-1.5 rounded-full bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 text-xs";
                keyCheckIcon.classList.remove('hidden');
            } else {
                status.textContent = "○ Clé manquante : saisie requise ci-dessous";
                status.className = "inline-block px-4 py-1.5 rounded-full bg-amber-500/10 border border-amber-500/20 text-amber-400 text-xs";
                manualSection.classList.remove('hidden');
                keyCheckIcon.classList.add('hidden');
            }
        }

        function validateKeyInput() {
            const val = document.getElementById('manualApiKey').value.trim();
            if (val.length > 20) {
                updateStatusUI('valid');
            } else if (val.length === 0) {
                updateStatusUI('none');
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            if (ENV_API_KEY && ENV_API_KEY.length > 5) {
                updateStatusUI('env');
            } else {
                updateStatusUI('none');
            }
        });

        async function generateCode() {
            const promptInput = document.getElementById('userPrompt');
            const btn = document.getElementById('generateBtn');
            const loader = document.getElementById('btnLoader');
            const outputContainer = document.getElementById('outputContainer');
            const codeBlock = document.getElementById('codeBlock');
            const codeOutput = document.getElementById('codeOutput');
            const errorMsg = document.getElementById('errorMessage');
            const languageHint = document.getElementById('languageHint').value;
            const manualKey = document.getElementById('manualApiKey').value.trim();
            
            const finalKey = (ENV_API_KEY && ENV_API_KEY.length > 5) ? ENV_API_KEY : manualKey;

            if (!finalKey) {
                errorMsg.textContent = "Veuillez entrer une clé API valide.";
                errorMsg.classList.remove('hidden');
                return;
            }

            if (!promptInput.value.trim()) return;

            btn.disabled = true;
            loader.classList.remove('hidden');
            errorMsg.classList.add('hidden');
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${finalKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: promptInput.value }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });

                if (!response.ok) throw new Error("Clé invalide ou erreur API.");
                
                const data = await response.json();
                const generatedCode = data.candidates?.[0]?.content?.parts?.[0]?.text;

                if (generatedCode) {
                    outputContainer.classList.remove('hidden');
                    codeBlock.textContent = generatedCode.trim();
                    const langClass = languageHint === 'auto' ? 'language-javascript' : `language-${languageHint}`;
                    codeOutput.className = langClass;
                    codeBlock.className = langClass;
                    Prism.highlightElement(codeBlock);
                    outputContainer.scrollIntoView({ behavior: 'smooth' });
                }
            } catch (error) {
                errorMsg.textContent = error.message;
                errorMsg.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                loader.classList.add('hidden');
            }
        }

        function copyCode() {
            const code = document.getElementById('codeBlock').textContent;
            const copyText = document.getElementById('copyText');
            const textArea = document.createElement("textarea");
            textArea.value = code;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            copyText.textContent = "Copié !";
            setTimeout(() => { copyText.textContent = "Copier"; }, 2000);
            document.body.removeChild(textArea);
        }
    </script>
</body>
</html>
